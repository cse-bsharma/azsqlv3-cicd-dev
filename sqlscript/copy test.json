{
	"name": "copy test",
	"properties": {
		"content": {
			"query": "create user [Mysqlsp] from external provider;\ngrant control on database::azsqldw to Mysqlsp;\n\n--1c21b375-0832-4f1c-9d3b-03cb86db88d7\n--bod8Q~dOyDkbGiRt40i_yU~jvjrtRz9L~4XgHbKh\nCOPY INTO [Trip_demo]\nFROM \n'https://azlandingpilot.dfs.core.windows.net/pilot/NYCTripSmall.parquet' \nWITH ( \n    FILE_TYPE = 'Parquet',\n    CREDENTIAL=(IDENTITY= '1c21b375-0832-4f1c-9d3b-03cb86db88d7@https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/token',SECRET='bod8Q~dOyDkbGiRt40i_yU~jvjrtRz9L~4XgHbKh')\n)\n\nCOPY INTO [Trip_demo]\nFROM 'https://azlandingpilot.dfs.core.windows.net/pilot/NYCTripSmall.parquet'  \nWITH (\n    FILE_TYPE = 'Parquet',\n    CREDENTIAL = (IDENTITY = 'Managed Identity')\n)\n\nCOPY INTO [Trip_demo]\nFROM 'https://azlandingpilot.dfs.core.windows.net/pilot/NYCTripSmall.parquet'  \nWITH (\n    FILE_TYPE = 'Parquet'\n)\n\nCOPY INTO [emp_csv_copy]\nFROM \n'https://azlandingpilot.dfs.core.windows.net/pilot/emp.csv' \nWITH ( \n    FILE_TYPE = 'CSV',\n    FIRSTROW = 2,\n    CREDENTIAL=(IDENTITY= '1c21b375-0832-4f1c-9d3b-03cb86db88d7@https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/token',SECRET='bod8Q~dOyDkbGiRt40i_yU~jvjrtRz9L~4XgHbKh')\n)\n\nCOPY INTO [emp_csv_copy]\nFROM \n'https://azlandingpilot.dfs.core.windows.net/pilot/emp.csv' \nWITH ( \n    FILE_TYPE = 'CSV',\n    FIRSTROW = 2\n    --CREDENTIAL = (IDENTITY = 'Managed Identity')\n   -- CREDENTIAL=(IDENTITY= '1c21b375-0832-4f1c-9d3b-03cb86db88d7@https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/token',SECRET='bod8Q~dOyDkbGiRt40i_yU~jvjrtRz9L~4XgHbKh')\n)\n\n\n-- Create a database scoped credential.\nCREATE DATABASE SCOPED CREDENTIAL SP\nWITH\n    IDENTITY= '1c21b375-0832-4f1c-9d3b-03cb86db88d7@https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/token',\n    SECRET='bod8Q~dOyDkbGiRt40i_yU~jvjrtRz9L~4XgHbKh'\n;\n\n-- Create a database scoped credential MI\nCREATE DATABASE SCOPED CREDENTIAL  ServiceIdentity WITH IDENTITY = 'Managed Identity';\nCREATE EXTERNAL DATA SOURCE MyAzureStoragecsv\nWITH\n  ( LOCATION = 'abfss://pilot@azlandingpilot.dfs.core.windows.net/' ,\n    CREDENTIAL = ServiceIdentity \n  ) ;\n--user\n  CREATE EXTERNAL DATA SOURCE MyAzureStorageuser\nWITH\n  ( LOCATION = 'abfss://pilot@azlandingpilot.dfs.core.windows.net/'\n  ) ;\n\n\n\nCREATE EXTERNAL DATA SOURCE MyAzureStorage\nWITH\n  ( LOCATION = 'abfss://pilot@azlandingpilot.dfs.core.windows.net/' ,\n    CREDENTIAL = SP \n  ) ;\n\n\nCREATE EXTERNAL FILE FORMAT parquetfile1  \nWITH (  \n    FORMAT_TYPE = PARQUET\n);\n\nCREATE EXTERNAL FILE FORMAT textdelimited\nWITH (  \n    FORMAT_TYPE = DELIMITEDTEXT,  \n    FORMAT_OPTIONS (  \n        FIELD_TERMINATOR = ',')\n);\n\n\n\nCREATE EXTERNAL FILE FORMAT parquetfile1  \nWITH (  \n    FORMAT_TYPE = PARQUET\n);\n\n\n\ndrop EXTERNAL table trip_ext;\n\nCREATE EXTERNAL TABLE trip_ext\n(\n       [DateID] int NOT NULL,\n    [MedallionID] int NOT NULL,\n    [HackneyLicenseID] int NOT NULL,\n    [PickupTimeID] int NOT NULL,\n    [DropoffTimeID] int NOT NULL,\n    [PickupGeographyID] int NULL,\n    [DropoffGeographyID] int NULL,\n    [PickupLatitude] float NULL,\n    [PickupLongitude] float NULL,\n    [PickupLatLong] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [DropoffLatitude] float NULL,\n    [DropoffLongitude] float NULL,\n    [DropoffLatLong] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [PassengerCount] int NULL,\n    [TripDurationSeconds] int NULL,\n    [TripDistanceMiles] float NULL,\n    [PaymentType] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [FareAmount] money NULL,\n    [SurchargeAmount] money NULL,\n    [TaxAmount] money NULL,\n    [TipAmount] money NULL,\n    [TollsAmount] money NULL,\n    [TotalAmount] money NULL\n)  \nWITH (\n    LOCATION = 'NYCTripSmall.parquet',\n    DATA_SOURCE = MyAzureStorageuser,  \n    FILE_FORMAT = parquetfile1\n)\n\nselect * from trip_ext;\n\nCREATE  TABLE emp_csv_copy\n(firstname varchar(20),\nempid int\n)  \n\n\n\nCREATE EXTERNAL TABLE emp_csv\n(firstname varchar(20),\nempid int\n)  \nWITH (\n    LOCATION = 'emp.csv',\n    DATA_SOURCE = MyAzureStorage, \n   -- DATA_SOURCE = MyAzureStoragecsv, \n    FILE_FORMAT = textdelimited\n)\n\n\nCREATE EXTERNAL DATA SOURCE [externalstrg4] WITH \n(   LOCATION = N'abfss://pilot@azlandingpilot.dfs.core.windows.net/'\n);\n\ndrop table trip_ext_user;\n\nCREATE EXTERNAL TABLE trip_ext_user\n(\n       [DateID] int NOT NULL,\n    [MedallionID] int NOT NULL,\n    [HackneyLicenseID] int NOT NULL,\n    [PickupTimeID] int NOT NULL,\n    [DropoffTimeID] int NOT NULL,\n    [PickupGeographyID] int NULL,\n    [DropoffGeographyID] int NULL,\n    [PickupLatitude] float NULL,\n    [PickupLongitude] float NULL,\n    [PickupLatLong] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [DropoffLatitude] float NULL,\n    [DropoffLongitude] float NULL,\n    [DropoffLatLong] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [PassengerCount] int NULL,\n    [TripDurationSeconds] int NULL,\n    [TripDistanceMiles] float NULL,\n    [PaymentType] varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [FareAmount] money NULL,\n    [SurchargeAmount] money NULL,\n    [TaxAmount] money NULL,\n    [TipAmount] money NULL,\n    [TollsAmount] money NULL,\n    [TotalAmount] money NULL\n)  \nWITH (\n    LOCATION = 'NYCTripSmall.parquet',\n    DATA_SOURCE = externalstrg4,  \n    FILE_FORMAT = parquetfile1\n)\n\n\nselect * from trip_ext_user;\n\n\n--------------------------------------------- TelemetryDaywise2\n\nSELECT    *,\ncase  when  txtTimeBucket = '12 AM - 3 AM' then 1\n when  txtTimeBucket = '3 AM - 6 AM' then 2\n when txtTimeBucket =  '6 AM - 9 AM' then 3\n when txtTimeBucket =  '9 AM - 12 PM' then 4\n when txtTimeBucket =  '12 PM - 3 PM' then 5\n when txtTimeBucket =  '3 PM - 6 PM' then 6\n when txtTimeBucket =  '6 PM - 9 PM' then 7\n when txtTimeBucket =  '9 PM- 12 AM' then 8\nend as intTimeBucketSort,\ncase\nwhen txtmonth like 'Jan%' then 1\nwhen txtmonth like 'Feb%' then 2\nwhen txtmonth like 'Mar%' then 3\nwhen txtmonth like 'Apr%' then 4\nwhen txtmonth like 'May%' then 5\nwhen txtmonth like 'Jun%' then 6\nwhen txtmonth like 'Jul%' then 7\nwhen txtmonth like 'Aug%' then 8\nwhen txtmonth like 'Sep%' then 9\nwhen txtmonth like 'Oct%' then 10\nwhen txtmonth like 'Nov%' then 11\nwhen txtmonth like 'Dec%' then 12\nend as intMonthSort,\n(year(dtDate) * 100) + month(dtDate) as MonthSort,\n(year(dtDate) * 10000) + (month(dtDate)*100)+ DATEPART(WEEK, dtDate)  - DATEPART(WEEK, DATEADD(MM, DATEDIFF(MM,0,dtDate), 0))+ 1 as WeekSort\nfrom\n(\n--------------------------------------------1----------------------\nselect *, count(txtempdimkey) as intTotalHits\nfrom\n(\nselect  txtempdimkey,txtidDerived,convert(date,dteventtimestamp) as dtDate,\nconvert(char(3), dteventtimestamp, 0) +  ' '  +convert(varchar,year(dteventtimestamp)) as txtMonth ,\nconvert(char(3), dteventtimestamp, 0)+' '+convert(varchar,year(dteventtimestamp))+' - Week '+convert(varchar(50),DATEPART(WEEK, dteventtimestamp)  - DATEPART(WEEK, DATEADD(MM, DATEDIFF(MM,0,dteventtimestamp), 0))+ 1) as txtWeek,\ncase \nwhen datepart(hour,dteventtimestamp) in (0,1,2) then '12 AM - 3 AM'\nwhen datepart(hour,dteventtimestamp) in (3,4,5) then '3 AM - 6 AM'\nwhen datepart(hour,dteventtimestamp) in (6,7,8) then '6 AM - 9 AM'\nwhen datepart(hour,dteventtimestamp) in (9,10,11) then '9 AM - 12 PM'\nwhen datepart(hour,dteventtimestamp) in (12,13,14) then '12 PM - 3 PM'\nwhen datepart(hour,dteventtimestamp) in (15,16,17) then '3 PM - 6 PM'\nwhen datepart(hour,dteventtimestamp) in (18,19,20) then '6 PM - 9 PM'\nwhen datepart(hour,dteventtimestamp) in (21,22,23) then '9 PM- 12 AM'\nend as txtTimeBucket,'Telemetry' as txttransactionType\nfrom stagingbi.stgcorp.bipdwstgtelemetrydata with(nolock)\nwhere txtidDerived is not null and  txtidDerived not in ('','null') \nand txtempdimkey is not null\nand txtcontextchannel in ('infosys.dev.mobile.android','infosys.dev.mobile.ios')\nand txteid in ('impression','interact')\nand dtEventTimestamp >= '2021-09-20'\nand dtEventTimestamp <= getdate()\n) A\ngroup by txtempdimkey,txtidDerived,dtDate,txtMonth,txtWeek,txtTimeBucket,txttransactionType\n) main",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "azsqldw",
				"poolName": "azsqldw"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}